<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub AI Agent - Phase 3</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .form-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-section {
            margin-top: 30px;
        }

        .result-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #27ae60;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .result-card.error {
            border-left-color: #e74c3c;
        }

        .agent-name {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .agent-badge {
            background: #3498db;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .result-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .result-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .processing-time {
            background: #e8f5e8;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        .summary-section {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .error-message {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-top: 3px solid #3498db;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #2c3e50;
        }

        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ GitHub AI Agent</h1>
            <p>Phase 3: Advanced Intelligence - Multi-agent Workflow</p>
        </div>

        <div class="main-content">
            <div class="form-section">
                <h2>üìù Analyze GitHub Issue</h2>
                <form id="issueForm">
                    <div class="form-group">
                        <label for="title">Issue Title *</label>
                        <input type="text" id="title" name="title" required 
                               placeholder="e.g., Bug: Login fails on mobile">
                    </div>

                    <div class="form-group">
                        <label for="body">Issue Description *</label>
                        <textarea id="body" name="body" required 
                                  placeholder="Describe the issue in detail..."></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="file">Related File</label>
                            <input type="text" id="file" name="file" 
                                   placeholder="e.g., auth.py, login.js">
                        </div>

                        <div class="form-group">
                            <label for="priority">Priority</label>
                            <select id="priority" name="priority">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="labels">Labels (comma-separated)</label>
                        <input type="text" id="labels" name="labels" 
                               placeholder="e.g., bug, urgent, frontend">
                    </div>

                    <button type="submit" class="btn" id="analyzeBtn">
                        üöÄ Analyze Issue
                    </button>
                </form>
            </div>

            <div id="loadingSection" class="loading" style="display: none;">
                <div class="spinner"></div>
                <h3>ü§ñ Agents are analyzing your issue...</h3>
                <p>This may take a few seconds as our multi-agent system processes your request.</p>
            </div>

            <div id="resultsSection" class="results-section" style="display: none;">
                <div id="summarySection" class="summary-section">
                    <h3>üìä Analysis Summary</h3>
                    <p id="summaryText"></p>
                </div>

                <h3>ü§ñ Agent Results</h3>
                <div id="agentResults"></div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalAgents">0</div>
                        <div class="stat-label">Total Agents</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="successfulAgents">0</div>
                        <div class="stat-label">Successful</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalTime">0s</div>
                        <div class="stat-label">Total Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="taskId">-</div>
                        <div class="stat-label">Task ID</div>
                    </div>
                </div>
            </div>

            <div id="errorSection" style="display: none;"></div>
        </div>
    </div>

    <script>
        document.getElementById('issueForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Show loading
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('errorSection').style.display = 'none';
            document.getElementById('analyzeBtn').disabled = true;
            
            // Get form data
            const formData = new FormData(e.target);
            const issue = {
                title: formData.get('title'),
                body: formData.get('body'),
                file: formData.get('file') || null,
                priority: formData.get('priority'),
                labels: formData.get('labels') ? formData.get('labels').split(',').map(l => l.trim()) : [],
                title_embedding: Array(128).fill(0).map(() => Math.random()) // Mock embedding
            };
            
            try {
                // Send request to API
                const response = await fetch('/analyze_issue', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(issue)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    displayResults(data);
                } else {
                    displayError(data.detail || 'Unknown error occurred');
                }
            } catch (error) {
                displayError('Network error: ' + error.message);
            } finally {
                // Hide loading
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('analyzeBtn').disabled = false;
            }
        });
        
        function displayResults(data) {
            // Display summary
            document.getElementById('summaryText').textContent = data.summary;
            
            // Display agent results
            const resultsContainer = document.getElementById('agentResults');
            resultsContainer.innerHTML = '';
            
            data.results.forEach(result => {
                const resultCard = document.createElement('div');
                resultCard.className = `result-card ${result.success ? '' : 'error'}`;
                
                resultCard.innerHTML = `
                    <div class="agent-name">
                        ${result.agent_name}
                        <span class="agent-badge">${result.success ? '‚úÖ Success' : '‚ùå Error'}</span>
                    </div>
                    <div class="result-content">
                        <pre>${JSON.stringify(result.result, null, 2)}</pre>
                    </div>
                    <div class="result-meta">
                        <span>Processing Time: <span class="processing-time">${result.processing_time.toFixed(3)}s</span></span>
                        <span>Agent: ${result.agent_name}</span>
                    </div>
                `;
                
                if (result.error) {
                    resultCard.innerHTML += `<div class="error-message">Error: ${result.error}</div>`;
                }
                
                resultsContainer.appendChild(resultCard);
            });
            
            // Update stats
            document.getElementById('totalAgents').textContent = data.results.length;
            document.getElementById('successfulAgents').textContent = data.results.filter(r => r.success).length;
            document.getElementById('totalTime').textContent = data.total_time.toFixed(2) + 's';
            document.getElementById('taskId').textContent = data.task_id.substring(0, 8) + '...';
            
            // Show results
            document.getElementById('resultsSection').style.display = 'block';
        }
        
        function displayError(message) {
            const errorSection = document.getElementById('errorSection');
            errorSection.innerHTML = `
                <div class="error-message">
                    <h3>‚ùå Error Occurred</h3>
                    <p>${message}</p>
                </div>
            `;
            errorSection.style.display = 'block';
        }
        
        // Add some sample data for testing
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('title').value = 'Bug: Authentication fails on mobile devices';
            document.getElementById('body').value = 'Users are reporting that they cannot log in using mobile browsers. The login button appears to be disabled or unresponsive. This issue seems to affect both iOS and Android devices. Desktop browsers work correctly.';
            document.getElementById('file').value = 'src/auth/login.js';
            document.getElementById('priority').value = 'high';
            document.getElementById('labels').value = 'bug, mobile, urgent, authentication';
        });
    </script>
</body>
</html>

<body class="bg-gray-900 text-gray-100">
    <div class="max-w-4xl mx-auto p-6 h-screen flex flex-col">
        <h1 class="text-3xl font-bold text-center mb-8 text-cyan-400">My Private Copilot</h1>

        <div id="chat" class="flex-1 overflow-y-auto mb-4 space-y-4"></div>

        <form id="form" class="flex gap-3">
            <textarea id="msg" autocomplete="off" rows="3"
                placeholder="G√µ /help ƒë·ªÉ xem commands | /autofix | commit nh√© | t·∫°o branch..."
                class="flex-1 bg-gray-800 rounded-lg px-5 py-3 focus:outline-none focus:ring-2 focus:ring-cyan-500"></textarea>
            <button type="submit" class="bg-cyan-600 hover:bg-cyan-500 px-8 py-3 rounded-lg font-medium">G·ª≠i</button>
        </form>
        <div class="text-center text-sm text-gray-500 mt-2">
            üí° Commands: <span class="text-cyan-400">/help</span> | <span class="text-cyan-400">/autofix</span> | <span
                class="text-cyan-400">/test</span> | <span class="text-cyan-400">commit nh√©</span>
        </div>
    </div>

    <script>
        const sessionId = "{{ request.client.host }}-" + Date.now();
        const ws = new WebSocket(`ws://${location.host}/ws/${sessionId}`);

        ws.onmessage = (event) => {
            const chat = document.getElementById("chat");
            const div = document.createElement("div");
            div.className = "bg-gray-800 rounded-lg p-4 max-w-3xl ml-auto whitespace-pre-line leading-relaxed";
            div.textContent = event.data;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        };

        document.getElementById("form").onsubmit = (e) => {
            e.preventDefault();
            const input = document.getElementById("msg");
            if (!input.value.trim()) return;

            // Hi·ªÉn th·ªã tin nh·∫Øn ng∆∞·ªùi d√πng
            const chat = document.getElementById("chat");
            const userDiv = document.createElement("div");
            userDiv.className = "bg-cyan-900 rounded-lg p-4 max-w-3xl mr-auto whitespace-pre-line leading-relaxed";
            userDiv.textContent = input.value;
            chat.appendChild(userDiv);

            ws.send(input.value);
            input.value = "";
            chat.scrollTop = chat.scrollHeight;
        };
    </script>
</body>

</html>
